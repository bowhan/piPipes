<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Piper by bowhan</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>Piper</h1>
        <p>piRNA pipeline collection developed in the Zamore Lab and ZLab in UMass Medical School</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/bowhan/Piper" class="button fork"><strong>View On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/bowhan/Piper/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/bowhan/Piper/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <p><img src="https://dl.dropboxusercontent.com/u/5238651/pipipe%20logo.jpg" align="middle"></p>

<h1>
<a name="piper" class="anchor" href="#piper"><span class="octicon octicon-link"></span></a>Piper</h1>

<p><img src="https://dl.dropboxusercontent.com/u/5238651/Figure%201.jpg" align="middle"></p>

<p>A pipeline collection developed in the <a href="http://www.umassmed.edu/zamore">Zamore Lab</a> and <a href="http://zlab.umassmed.edu/zlab">ZLab</a> to analyze piRNA/transposon from different Next Generation Sequencing (<em>small RNA-seq</em>, <em>RNA-seq</em>, <em>Genome-seq</em>, <em>ChIP-seq</em>, <em>CAGE/Degradome-Seq</em>).           </p>

<p>In order to achieve a generic interface in terms of the genome assembles it supports, <strong>piper</strong> also provides a installation pipeline to download ready-to-use genome annotation packages from <a href="https://support.illumina.com/sequencing/sequencing_software/igenome.ilmn">Illumina iGenome</a> as well as <a href="http://genome.ucsc.edu/">UCSC Genome Browser</a>.          </p>

<p>For <em>small RNA-Seq</em>, <em>RNA-Seq</em> and <em>ChIP-Seq</em> pipelines, <strong>piper</strong> provides two modes: <code>a single library mode</code> and <code>dual library mode</code>, to analyze single library and pair-wise comparison between two samples respectively.        </p>

<h2>
<a name="install" class="anchor" href="#install"><span class="octicon octicon-link"></span></a>INSTALL</h2>

<div class="highlight highlight-bash"><pre><span class="c"># get piper code from github</span>
git clone https://github.com/bowhan/Piper.git
</pre></div>

<p><strong>piper</strong> is written in Bash, C++, Perl, Python and R. It currently only works under Linux environment.</p>

<hr><h3>
<a name="cc" class="anchor" href="#cc"><span class="octicon octicon-link"></span></a>C/C++</h3>

<p><strong>Piper</strong> comes with statically compiled linux x86_64 binaries for its own C++ scripts and the other tools written in C/C++. Ideally, the users don't need to do any compiling. But if the static versions do not work in your system, exemplified by the error message "kernel too old", please compile them from src and move the binaries to the <code>bin</code>. Please install <strong>BEDtools</strong>, using the source code in the <code>third_party</code> directory and rename it as <code>bedtools_piper</code> in the <code>bin</code> directory of <code>piper</code>.<br>
Most of <strong>piper's</strong> C++ code utilizes <em>C++11</em> features and <em>Boost</em> library. It is recommended to install relatively new <a href="http://gcc.gnu.org/">GCC</a> and <a href="http://www.boost.org/users/download/">Boost</a> for compiling them.         </p>

<hr><h3>
<a name="pythoncython" class="anchor" href="#pythoncython"><span class="octicon octicon-link"></span></a>Python/Cython</h3>

<p><strong>For MACS2 and HTSeq-count, the users will need to install them and make them available in their <code>$PATH</code>.</strong><br><em>We cannot find a good way to ship the ready-to-use Cython code. Without <code>htseq-count</code>, <code>piper rna/deg/cage</code> won't be able to make transcripts/transposon counting using genomic coordinates. But it will still perform other functions of the pipeline, including quantification using Cufflinks and eXpress. Without <code>macs2</code>, <code>piper chip/chip2</code> won't work at all</em>.</p>

<hr><h3>
<a name="r" class="anchor" href="#r"><span class="octicon octicon-link"></span></a>R</h3>

<p>For R packages that are unavailable in the user's system, the installation is performed during the <code>piper install</code> process. They will be installed in the same directory as the pipeline in case the user doesn't have write permission in the R installation directory.</p>

<hr><h3>
<a name="genome-annotation" class="anchor" href="#genome-annotation"><span class="octicon octicon-link"></span></a>Genome Annotation</h3>

<p>Due to the limitation on the size of the files on github, the genome sequence, most annotation files are to be downloaded from somewhere else and reformatted to accommodate the pipeline. <strong>piper</strong> uses <a href="http://support.illumina.com/sequencing/sequencing_software/igenome.ilmn">iGenome</a> and provides <code>piper install</code> to download iGenome genomes and organize the files to be used by the pipeline (see below).        </p>

<hr><p><strong>piper</strong> uses the following public tools:</p>

<ol>
<li><p>For alignment, <strong>piper</strong> uses <a href="http://bowtie-bio.sourceforge.net/index.shtml">Bowtie</a>, <a href="http://bowtie-bio.sourceforge.net/bowtie2/index.shtml">Bowtie2</a>, <a href="http://bio-bwa.sourceforge.net/">BWA</a>,  <a href="https://code.google.com/p/rna-star/">STAR</a> and <a href="http://mrfast.sourceforge.net/">mrFast</a> for different purposes.       </p></li>
<li><p>For transcripts/transposons quantification, <strong>piper</strong> uses <a href="http://cufflinks.cbcb.umd.edu/">Cufflinks</a>, <a href="http://www-huber.embl.de/users/anders/HTSeq/">HTSeq</a> and <a href="http://bio.math.berkeley.edu/eXpress">eXpress</a> under different circumstances.     </p></li>
<li><p>For transposon mobilization as well as other structural variants discovery, <strong>piper</strong> uses <a href="http://zlab.umassmed.edu/%7Ezhuangj/TEMP/">TEMP</a>, <a href="http://gmt.genome.wustl.edu/breakdancer/current/">BreakDancer</a>, <a href="https://github.com/tk2/RetroSeq">RetroSeq</a> and <a href="http://compbio.cs.sfu.ca/software-variation-hunter">VariationHunter</a>.    </p></li>
<li><p>For ChIP-Seq peaks calling, <strong>piper</strong> uses <a href="https://github.com/taoliu/MACS">MACS2</a>. For TSS/TES/metagene analysis, <strong>piper</strong> uses <a href="https://github.com/CRG-Barcelona/bwtool">bwtool</a>.    </p></li>
<li><p>Additionally, <strong>piper</strong> uses many tools from the <a href="http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64.v287/">Kent Tools</a>, like <code>faSize</code>, <code>bedGraphToBigWig</code>.   </p></li>
<li><p>To wrap bash scripts for multi-threading, <strong>piper</strong> utilizes <code>ParaFly</code> from <a href="http://trinityrnaseq.sourceforge.net/">Trinity</a>. <strong>piper</strong> also learns the <code>touch</code> trick for job resuming from <a href="http://trinityrnaseq.sourceforge.net/">Trinity</a>.        </p></li>
<li><p>To determine the version of FastQ, <strong>piper</strong> uses <code>SolexaQA.pl</code> from <a href="http://solexaqa.sourceforge.net/">SolexaQA</a>. <strong>Piper</strong> have modified it in a way that the program exits as soon as the version of FastQ has been determined. The modified code can be found in the <code>bin</code> directory.        </p></li>
<li><p><strong>piper</strong> uses <a href="https://github.com/bowhan/bedtools.git">BEDtools</a> to assign alignments to different genomic annotations (gene, transposon, piRNA cluster, et al.). In small RNA pipeline, we made a slightly modification on <code>intersectBed.cpp</code> to accommodate a special BED format used in the pipeline. The modified code can be found in the <code>src/third_party</code> folder. A statically compiled binary, which has been renamed as <code>bedtools_piper</code> to avoid confusion with the original one, can be found in the <code>bin</code> directory.                        </p></li>
</ol><h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>USAGE</h2>

<p>The pipeline finds almost everything under its own directory so please do not move the <code>zpipe</code> script. Use <code>ln  -s  $PATH_TO_piper/piper  $HOME/bin/piper</code> to create symbol link in your <code>$HOME/bin</code>; Or add <code>/path/to/piper</code> to your <code>$PATH</code>. 
<strong>But please do NOT add the <code>/path/to/piper/bin</code> to your <code>$PATH</code></strong></p>

<p>Call different pipelines using:     </p>

<div class="highlight highlight-Bash"><pre><span class="c"># genome installation pipeline</span>
 <span class="c"># 1. to install genome and R packages in one step</span>
 <span class="c"># the assembly that piper supports can be found in the common/iGenome_UTL.txt file</span>
<span class="nv">$PATH_TO_piper</span>/piper    install -g dm3<span class="p">|</span>mm9<span class="p">|</span>hg19... 
 <span class="c"># 2. to only download the genome and R packages (if the machine/node is not appropriate to be used for heavy computing tasks, like building indexes); then run (1) on a powerful mechine/node.</span>
<span class="nv">$PATH_TO_piper</span>/piper    install -g dm3<span class="p">|</span>mm9<span class="p">|</span>hg19 -D
 <span class="c"># 3. to download the iGenome from other explicitly specified location</span>
<span class="nv">$PATH_TO_piper</span>/piper    install -g hg18 -l ftp://igenome:G3nom3s4u@ussd-ftp.illumina.com/Homo_sapiens/UCSC/hg18/Homo_sapiens_UCSC_hg18.tar.gz

<span class="c"># to run small RNA pipeline in single library mode; input fastq can be gzipped</span>
<span class="nv">$PATH_TO_piper</span>/piper    small -i input.trimmed.fq<span class="o">[</span>.gz<span class="o">]</span> -g dm3 -c 24

<span class="c"># to run small RNA pipeline in dual library mode (need single library mode output for each sample first)</span>
<span class="nv">$PATH_TO_piper</span>/piper    small2 -a directory_A -b directory_B -g dm3 -c 24
<span class="c"># to run small RNA pipeline in dual library mode, normalized to miRNA </span>
<span class="nv">$PATH_TO_piper</span>/piper    small2 -a directory_A -b directory_B -g dm3 -c 24 -N miRNA
<span class="c"># to run small RNA pipeline in dual library mode, normalized to siRNA (structural loci and cis-NATs), for oxidation sample of -fruitfly only-</span>
<span class="nv">$PATH_TO_piper</span>/piper    small2 -a directory_A -b directory_B -g dm3 -c 24 -N siRNA

<span class="c"># to run RNASeq pipeline in single library mode, dUTP based method</span>
<span class="nv">$PATH_TO_piper</span>/piper    rnaseq -l left.fq -r right.fq -g mm9 -c 8 -o output_dir

<span class="c"># to run RNASeq pipeline in single library mode, ligation based method</span>
<span class="nv">$PATH_TO_piper</span>/piper    rnaseq -l left.fq -r right.fq -g mm9 -c 8 -o output_dir -L

<span class="c"># to run RNASeq pipeline in dual library mode (need single library mode been ran for each sample first)</span>
<span class="nv">$PATH_TO_piper</span>/piper    rnaseq2 -a directory_A -b directory_B -g mm9 -c 8 -o output_dir -A w1 -B piwi

<span class="c"># to run Degradome/RACE/CAGE-Seq library </span>
<span class="nv">$PATH_TO_piper</span>/piper    deg -l left.fq -r right.fq -g dm3 -c 12 -o output_dir

<span class="c"># to run Degradome library to check ping-pong signature with a small RNA library (need the small RNA library ran first)</span>
<span class="nv">$PATH_TO_piper</span>/piper    deg -l left.fq -r right.fq -g dm3 -c 12 -o output_dir -s /path/to/small_RNA_library_output

<span class="c"># to run ChIP Seq library in single library mode, for narrow peak, like transcriptional factor</span>
<span class="nv">$PATH_TO_piper</span>/piper    chip -l left.IP.fq -r right.IP.fq -L left.INPUT.fq -R right.INPUT.fq -g mm9 -c 8 -o output_dir

<span class="c"># to run ChIP Seq library in single library mode, for broad peak, like H3K9me3</span>
<span class="nv">$PATH_TO_piper</span>/piper    chip -l left.IP.fq -r right.IP.fq -L left.INPUT.fq -R right.INPUT.fq -g mm9 -c 8 -o output_dir -B

<span class="c"># to run ChIP Seq library in single library mode, only use unique mappers (otherwise Bowtie2 randomly choose one best alignment for each read)</span>
<span class="nv">$PATH_TO_piper</span>/piper    chip -l left.IP.fq -r right.IP.fq -L left.INPUT.fq -R right.INPUT.fq -g mm9 -c 8 -o output_dir -Q 10

<span class="c"># to run ChIP Seq library in dual library mode (need single library mode been ran for each sample first)</span>
<span class="nv">$PATH_TO_piper</span>/piper    chip2 -a directory_A -b directory_B -g mm9 -c 8 -o output_dir

<span class="c"># to run ChIP Seq library in dual library mode, extend up/down stream 5000 bp for TSS/TES/meta analysis (for bwtool)</span>
<span class="nv">$PATH_TO_piper</span>/piper    chip2 -a directory_A -b directory_B -g mm9 -c 8 -o output_dir -x 5000

<span class="c"># to run Genome Seq library</span>
<span class="nv">$PATH_TO_piper</span>/piper    dna -l left.fq -r right.fq -g dm3 -c 24 -D 100
</pre></div>

<p>Find more detailed information on <a href="https://github.com/bowhan/piper/wiki">Wiki</a></p>

<h3>
<a name="install--to-install-genome-assembly" class="anchor" href="#install--to-install-genome-assembly"><span class="octicon octicon-link"></span></a><em>install</em> : to install genome assembly</h3>

<p>Due to the limitation on the size of file by github, piper doesn't ship with the genome sequences and annotation. Alternatively, we provide scrips to download genome assemly files from iGenome project of illumina. Please make sure internet is available during this process.  <strong>piper</strong> provides an option to separate downloading from other processes, in case the machine/node with internet access is not appropriate for building index and other works.<br>
Except for the genome, this pipeline will also install unavailable R packages under the pipeline directory. The downloading and installation can be separated using -D option, in case the head node is not supposed to be used for heavy computational work, like building indexes.<br>
Currently, <strong>piper</strong> comes with annotation files for <em>Drosophila melanogaster (dm3)</em>, <em>Mus musculus (mm9)</em>, <em>Homo sapiens (hg19)</em>, <em>Danio rerio (danRer7)</em>, <em>Rattus norvegicus (rn5)</em>, and <em>Bos taurus (bosTau7)</em>. <em>Arabidopsis thaliana (TARI10)</em> is also included (but not rigorously tested), though no piRNA has been described in plants. </p>

<p>A more detailed explanation can be found <a href="https://github.com/bowhan/piper/wiki/installation">here</a>.  </p>

<h3>
<a name="small--small-rna-pipeline" class="anchor" href="#small--small-rna-pipeline"><span class="octicon octicon-link"></span></a><em>small</em> : small RNA pipeline</h3>

<p>small RNA library typically clones 18â€“40nt small RNAs, including miRNA, siRNA and 
piRNA. This pipeline maps those reads to rRNA, microRNA hairpin, genome, repbase 
annotated  transposons, piRNA clusters with bowtie and uses bedtools to assign 
them to different annotations. For each feature, length distribution, nucleotide percentage, 
ping-pong score, et al.,  are calculated and graphed. Some microRNA analysis is also included. 
In the dual library mode, pair-wise comparison of miRNA and piRNAs will be done. We invented this balloon-plot to efficiently compare the heterogeneity of miRNA between two samples. piRNA for different transposon family is also compared. 
For small RNA tailing analysis, please use <a href="http://jhhung.github.io/Tailor/">Tailor</a> and its associated pipeline. It is current not included in <strong>piper</strong>.          </p>

<p>A more detailed explanation can be found <a href="https://github.com/bowhan/piper/wiki/smallRNA">here</a>.</p>

<h3>
<a name="rnaseq--rnaseq-pipeline" class="anchor" href="#rnaseq--rnaseq-pipeline"><span class="octicon octicon-link"></span></a><em>rnaseq</em> : RNASeq pipeline</h3>

<p>RNASeq pipeline can be used for both dUTR or ligation based RNASeq. 
It uses bowtie2 to aligns paired-end reads to rRNA and STAR[4] to align the unmapped reads 
to genome; Then it uses Cufflinks for quantification of transcripts from the genomic coordinates. It
also use HTSeq-count to quantify genomic features using coordinates. It also directly aligns reads to 
transcriptome, repbase annotated transposon, piRNA clusters using Bowtie2. Quantification 
was done using eXpress. Library is normalized by gene transcriptome compatible reads, given by Cufflinks. Basic statistics and graphs will be given. </p>

<p>A more detailed explanation can be found <a href="https://github.com/bowhan/piper/wiki/RNASeq">here</a>.  </p>

<h3>
<a name="cagedeg--cage--degradome-pipeline" class="anchor" href="#cagedeg--cage--degradome-pipeline"><span class="octicon octicon-link"></span></a><em>cage/deg</em> : CAGE &amp; Degradome pipeline</h3>

<p>Both types of libraries are designed to gather the information of the 5' end of RNAs 
CAGE clones RNAs with Cap and Degradome clones RNAs with 5' monophosphate. 
The pipeline will align reads to rRNA with bowtie2, genome using STAR. 
Different from RNASeq, this pipeline emphasizes the accuracy of the 5' ends. Nucleotide
composition surrounding the 5' end of the reads are given, like in small RNA library.</p>

<p>A more detailed explanation can be found <a href="https://github.com/bowhan/piper/wiki/DegradomeSeq">here</a>.</p>

<h3>
<a name="chip--chip-seq-pipeline" class="anchor" href="#chip--chip-seq-pipeline"><span class="octicon octicon-link"></span></a><em>chip</em> : ChIP-Seq pipeline</h3>

<p>ChIP Seq pipeline aligns both input and ChIP data to genome with Bowtie2. Peak calling was done
using MASC2. Signal is normalized in three different methods (ppois, FE and logLR). TSS/TES/meta plots are drawn using bwtool. In the dual library mode, peak calling is redone for each sample without inter-library normalization, by differential peak calling algorithm of MACS2 directly. TSS/TES/meta plots are drawn for those loci using the normalized signal. </p>

<p>A more detailed explanation can be found <a href="https://github.com/bowhan/piper/wiki/ChIPSeq">here</a>. </p>

<h3>
<a name="dna--genomic-seq-pipeline" class="anchor" href="#dna--genomic-seq-pipeline"><span class="octicon octicon-link"></span></a><em>dna</em> : Genomic Seq pipeline</h3>

<p>Genomic Seq pipelines aligns the paired-end reads to genome with Bowtie2, BWA-MEM and mrFast. Variations
were called using different algorithms. </p>

<p>A more detailed explanation can be found <a href="https://github.com/bowhan/piper/wiki/GenomeSeq">here</a>.</p>

<h2>
<a name="citation" class="anchor" href="#citation"><span class="octicon octicon-link"></span></a>CITATION</h2>

<ul>
<li>in preparation</li>
</ul><h2>
<a name="contact" class="anchor" href="#contact"><span class="octicon octicon-link"></span></a>CONTACT</h2>

<pre><code>Wei Wang (wei.wang2 `at` umassmed.edu)
Bo W Han (bo.han `at` umassmed.edu, bowhan `at` me.com)
</code></pre>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>LICENSE</h2>

<p><strong>Piper</strong> is released under the <a href="https://www.gnu.org/licenses/gpl.html">GNU General Public License version 3</a>.      </p>

<h2>
<a name="references" class="anchor" href="#references"><span class="octicon octicon-link"></span></a>REFERENCES</h2>

<pre><code>[1] Li H and Durbin R. 2009. Fast and accurate short read alignment with Burrows-Wheeler transform. Bioinformatics 25: 1754-1760.
[2] Langmead B, Trapnell C, Pop M and Salzberg SL. 2009. Ultrafast and memory-efficient alignment of short DNA sequences to the human genome. Genome Biol 10: R25.
[3] Langmead B and Salzberg SL. 2012. Fast gapped-read alignment with Bowtie 2. Nat Methods 9: 357-359.
[4] Dobin A, Davis CA, Schlesinger F, Drenkow J, Zaleski C, Jha S, Batut P, Chaisson M and Gingeras TR. 2013. STAR: ultrafast universal RNA-seq aligner. Bioinformatics 29: 15-21.
[5] Trapnell C, Williams BA, Pertea G, Mortazavi A, Kwan G, van Baren MJ, Salzberg SL, Wold BJ and Pachter L. 2010.
[6] Transcript assembly and quantification by RNA-Seq reveals unannotated transcripts and isoform switching during cell differentiation. Nat Biotechnol 28: 511-515.
[7] Kent WJ, Zweig AS, Barber G, Hinrichs AS and Karolchik D. 2010. BigWig and BigBed: enabling browsing of large distributed datasets. Bioinformatics 26: 2204-2207.
[8] Zhang Y et al. 2008. Model-based analysis of ChIP-Seq (MACS). Genome Biol 9: R137.
[9] Roberts A and Pachter L. 2013. Streaming fragment assignment for real-time analysis of sequencing experiments. Nat Methods 10: 71-73.
[10] Grabherr MG et al. 2011. Full-length transcriptome assembly from RNA-Seq data without a reference genome. Nat Biotechnol 29: 644-652.
[11] Karolchik D, Hinrichs AS, Furey TS, Roskin KM, Sugnet CW, Haussler D and Kent WJ. 2004. The UCSC Table Browser data retrieval tool. Nucleic Acids Res 32: D493-D496.
[12] Cox MP, Peterson DA and Biggs PJ. 2010. SolexaQA: At-a-glance quality assessment of Illumina second-generation sequencing data. BMC Bioinformatics 11: 485.
[13] HTSeq: Analysing high-throughput sequencing data with Python. [http://www-huber.embl.de/users/anders/HTSeq/]
[14] Keane TM, Wong K and Adams DJ. 2013. RetroSeq: transposable element discovery from next-generation sequencing data. Bioinformatics 29: 389-390.
[15] Hormozdiari F, Hajirasouliha I, Dao P, Hach F, Yorukoglu D, Alkan C, Eichler EE and Sahinalp SC. 2010. Next-generation VariationHunter: combinatorial algorithms for transposon insertion discovery. Bioinformatics 26: i350-i357.
[16] Pohl, A. &amp; Beato, M. bwtool: a tool for bigWig files. Bioinformatics (2014).
[17] Zhang, H., Meltzer, P. &amp; Davis, S. RCircos: an R package for Circos 2D track plots. BMC Bioinformatics 14, 244 (2013).
</code></pre>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/bowhan">bowhan</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>